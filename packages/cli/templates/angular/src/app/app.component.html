<div class="mx-auto grid min-h-screen max-w-7xl gap-6 p-6 lg:grid-cols-[2fr_1fr]">
  <main class="space-y-4">
    <h1 class="text-4xl font-bold tracking-tight">Nearstack + Angular</h1>
    <section class="rounded-xl border border-slate-700 bg-slate-900/60 p-4">
      <h2 class="text-xl font-semibold">Todos</h2>
      <form class="mt-3 flex gap-2" (ngSubmit)="addTodo()">
        <input
          class="flex-1 rounded-md border border-slate-700 bg-slate-950 px-3 py-2"
          [(ngModel)]="todoTitle"
          name="todoTitle"
          placeholder="Add a task"
        />
        <button class="rounded-md bg-cyan-500 px-4 py-2 font-medium text-slate-950" type="submit">Add</button>
      </form>
      <ul class="mt-4 space-y-2">
        <li *ngFor="let todo of todos" class="flex items-center justify-between rounded-md border border-slate-700 p-2">
          <label class="flex items-center gap-3">
            <input type="checkbox" [checked]="todo.completed" (change)="toggle(todo)" />
            <span [class.line-through]="todo.completed" [class.opacity-50]="todo.completed">{{ todo.title }}</span>
          </label>
          <button class="text-sm text-rose-300" type="button" (click)="remove(todo.id)">Delete</button>
        </li>
      </ul>
    </section>
  </main>

  <aside class="space-y-4">
    <section class="rounded-xl border border-slate-700 bg-slate-900/60 p-4">
      <h2 class="text-xl font-semibold">Model Setup</h2>
      <select
        class="mt-3 w-full rounded-md border border-slate-700 bg-slate-950 px-3 py-2"
        [ngModel]="selectedModel"
        (ngModelChange)="onModelChange($event)"
        name="selectedModel"
      >
        <option value="">Select a model</option>
        <option *ngFor="let model of models" [value]="model.id">{{ model.provider }} Â· {{ model.name }}</option>
      </select>
      <p *ngIf="isDownloading" class="mt-3 text-sm text-slate-300">Downloading {{ (downloadProgress * 100) | number: '1.0-0' }}%</p>
    </section>

    <section class="rounded-xl border border-slate-700 bg-slate-900/60 p-4">
      <h2 class="text-xl font-semibold">AI Chat</h2>
      <div class="mt-3 h-80 space-y-2 overflow-y-auto rounded-md border border-slate-700 bg-slate-950 p-2">
        <p *ngIf="messages.length === 0" class="text-sm text-slate-400">Ask AI about your todos.</p>
        <div
          *ngFor="let message of messages; index as i"
          [class]="'max-w-[90%] rounded-md px-3 py-2 text-sm ' + (message.role === 'assistant' ? 'bg-slate-800' : 'ml-auto bg-cyan-500 text-slate-950')"
        >
          {{ message.content }}
        </div>
      </div>
      <p *ngIf="error" class="mt-2 text-sm text-rose-300">{{ error }}</p>
      <form class="mt-3 flex gap-2" (ngSubmit)="sendMessage()">
        <input
          class="flex-1 rounded-md border border-slate-700 bg-slate-950 px-3 py-2"
          [(ngModel)]="chatInput"
          name="chatInput"
          placeholder="Ask about your todos..."
        />
        <button class="rounded-md bg-cyan-500 px-4 py-2 font-medium text-slate-950" [disabled]="isSending || !selectedModel" type="submit">Send</button>
      </form>
    </section>
  </aside>
</div>
